
services:
  duplicacy:
    container_name: duplicacy
    hostname: duplicacy
    image: saspus/duplicacy-web:latest
    ports:
      - "3875:3875"
    environment:
      - TZ=${TZ}
    volumes:
      - ${STORAGE_LOCATION}/duplicacy-config:/config
      - ${STORAGE_LOCATION}/logs/duplicacy:/logs
      - ${STORAGE_LOCATION}/duplicacy-cache:/cache
      - ${MEDIA_LOCATION}:/Media:ro
      - ${MEDIA_LOCATION}/Restore:/Restore
      - ${STORAGE_LOCATION}:/backup/appdata:ro
      # Docker-managed CIFS volumes
      - hass_config:/backup/hass/config:ro
      - hass_media:/backup/hass/media:ro
      - hass_share:/backup/hass/share:ro
      - hass_addon_configs:/backup/hass/addon_configs:ro
      - hass_addons:/backup/hass/addons:ro
      - hass_backup:/backup/hass/backup:ro
      - hass_ssl:/backup/hass/ssl:ro
    restart: unless-stopped
    networks:
      - frontend-net
    labels:
      # --- Traefik Routing ---
      - "traefik.enable=true"
      - "traefik.http.routers.duplicacy.rule=Host(`duplicacy.${HOSTDOMAIN}`)"
      - "traefik.http.routers.duplicacy.entrypoints=websecure" # Use 443
      - "traefik.http.routers.duplicacy.tls=true"
      - "traefik.http.routers.duplicacy.tls.certresolver=cloudflare" 
      - "traefik.http.services.duplicacy.loadbalancer.server.port=3875"
      # --- Homepage Discovery ---
      - "homepage.group=Infra"
      - "homepage.name=Duplicacy"
      - "homepage.icon=duplicacy.png"
      - "homepage.href=https://duplicacy.${HOSTDOMAIN}"
      - "homepage.description=Backup Systems"



volumes:
  hass_config:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/config"
  hass_media:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/media"
  hass_share:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/share"
  hass_addon_configs:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/addon_configs"
  hass_addons:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/addons"
  hass_backup:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/backup"
  hass_ssl:
    driver_opts:
      type: cifs
      o: "username=${HASS_USER},password=${HASS_PASS},addr=${HASS_HOST}"
      device: "//${HASS_HOST}/ssl"

  frontend-net:
    external: true
