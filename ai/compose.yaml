services:
  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: open-webui
    restart: unless-stopped
    environment:
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - WEBUI_SECRET_KEY=${WEBUI_SECRET_KEY}
    volumes:
      - ${STORAGE_LOCATION}/open-webui-data:/app/backend/data
    networks:
      - app-ai-net
      - frontend-net
    labels:
      # --- Traefik Routing ---
      - "traefik.enable=true"
      - "traefik.http.routers.openwebui.rule=Host(`ai.skyelowry.com`)"
      - "traefik.http.routers.openwebui.entrypoints=websecure" # Use 443
      - "traefik.http.routers.openwebui.tls=true"
      - "traefik.http.routers.openwebui.tls.certresolver=cloudflare" 
      - "traefik.http.services.openwebui.loadbalancer.server.port=8080"
      # --- Homepage Discovery ---
      - "homepage.group=AI"
      - "homepage.name=Open WebUI"
      - "homepage.icon=open-webui.png"
      - "homepage.href=https://ai.skyelowry.com"
      - "homepage.description=Local LLM Interface"

networks:
  app-ai-net:
    name: "app-ai-net"
  frontend-net:
    external: true
